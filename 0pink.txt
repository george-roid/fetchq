window.stopZeroCounter = false; // Set to true to stop at any time

// Create or reuse a textarea for live results
let textarea = document.getElementById('zeroGirlLinksTextarea');
if (!textarea) {
    textarea = document.createElement('textarea');
    textarea.id = 'zeroGirlLinksTextarea';
    textarea.style.position = 'fixed';
    textarea.style.bottom = '10px';
    textarea.style.left = '10px';
    textarea.style.width = '400px';
    textarea.style.height = '200px';
    textarea.style.zIndex = 99999;
    textarea.style.background = '#fff';
    textarea.style.fontSize = '12px';
    textarea.style.border = '2px solid #333';
    textarea.style.padding = '8px';
    textarea.readOnly = false;
    document.body.appendChild(textarea);
}

async function collectZeroGirlLinksLive(maxLinks = 1000, scrollDelay = 1500) {
    let zeroGirlLinks = new Set();
    let lastHeight = 0;
    let attemptsWithoutNew = 0;

    console.log("Started collecting. Set window.stopZeroCounter = true in the console to stop at any time.");

    while (zeroGirlLinks.size < maxLinks && attemptsWithoutNew < 10 && !window.stopZeroCounter) {
        let foundThisRound = 0;

        let spans = Array.from(document.querySelectorAll('span.ibar-opcounters'));
        spans.forEach(span => {
            let girlA = span.querySelector('a[href*="#girls"]');
            if (girlA) {
                let counter = girlA.querySelector('.girlcounter');
                if (counter && counter.textContent.trim() === "0") {
                    let link = girlA.href.replace(/#girls$/, '');
                    if (!zeroGirlLinks.has(link)) {
                        zeroGirlLinks.add(link);
                        foundThisRound++;
                    }
                }
            }
        });

        // Update textarea live
        textarea.value = Array.from(zeroGirlLinks).join('\n');

        if (foundThisRound > 0) {
            console.log(`[${zeroGirlLinks.size}] links collected so far... (+${foundThisRound} new)`);
        } else {
            console.log(`[${zeroGirlLinks.size}] links collected so far...`);
        }

        window.scrollTo(0, document.body.scrollHeight);
        await new Promise(res => setTimeout(res, scrollDelay));

        let newHeight = document.body.scrollHeight;
        if (newHeight === lastHeight) {
            attemptsWithoutNew++;
        } else {
            attemptsWithoutNew = 0;
            lastHeight = newHeight;
        }
    }

    let result = Array.from(zeroGirlLinks).slice(0, maxLinks);
    window.latestZeroGirlLinks = result;
    textarea.value = result.join('\n'); // Final update
    console.log(`Done! Collected ${result.length} links. You can copy them from the textarea on the page.`);
    return result;
}

// Usage:
collectZeroGirlLinksLive(1000, 1500);
